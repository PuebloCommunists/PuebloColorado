<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login | Organize</title>
<style>
  :root {
    --red: #e63946;
    --dark-red: #c1121f;
    --yellow: #ffd166;
    --dark-blue: #1d3557;
    --light: #f1faee;
    --gray: #8d99ae;
  }
  
  body { 
    font-family: Arial, Helvetica, sans-serif; 
    background: linear-gradient(135deg,#ff5252,#000); 
    height:100vh; 
    margin:0; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    color:white; 
    position: relative;
  }
  
  .container { 
    width:360px; 
    padding:2rem; 
    border-radius:12px; 
    background: rgba(255,255,255,0.06); 
    box-shadow:0 6px 24px rgba(0,0,0,0.4); 
    text-align:center; 
  }
  
  h2 { 
    margin:0 0 1rem 0; 
    color:white; 
  }
  
  input { 
    width:92%; 
    padding:10px; 
    margin:8px 0; 
    border-radius:8px; 
    border:none; 
    outline:none; 
  }
  
  button { 
    width:95%; 
    padding:10px; 
    margin-top:10px; 
    border-radius:8px; 
    border:none; 
    cursor:pointer; 
    font-weight:bold; 
  }
  
  .btn-white { 
    background:white; 
    color:black; 
  }
  
  .btn-primary { 
    background:#ff5252; 
    color:white; 
  }
  
  .toggle { 
    margin-top:10px; 
    color:#ddd; 
    cursor:pointer; 
    font-size:0.95rem; 
  }
  
  .note { 
    margin-top:8px; 
    font-size:0.85rem; 
    color:#eee; 
    opacity:0.9; 
  }
  
  /* Top-right button - matching mission.html style */
  .top-btn {
    position: fixed;
    top: 25px;
    right: 25px;
    width: 65px;
    height: 65px;
    background: var(--red);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    transition: 0.3s;
    z-index: 1000;
    border-radius: 50%;
  }
  
  .top-btn img {
    width: 70%;
    height: 70%;
    object-fit: cover;
    pointer-events: none;
    border-radius: 50%;
  }
  
  .top-btn:hover {
    box-shadow: 0 0 20px var(--red), 0 0 30px var(--red);
    transform: scale(1.1);
    background: var(--dark-red);
  }

  /* Popup overlay */
  .popup-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    align-items: center;
    justify-content: center;
    z-index: 2000;
  }
  
  .popup {
    position: relative;
    background: rgba(29, 53, 87, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 60px 60px 50px;
    border-radius: 10px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5), 0 0 20px rgba(230, 57, 70, 0.3);
    min-width: 400px;
    max-width: 675px;
    text-align: center;
    animation: fadeIn 0.4s ease;
    border: 2px solid var(--red);
    color: var(--light);
  }
  
  .close-popup {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    width: 40px;
    height: 40px;
    cursor: pointer;
    line-height: 1;
    text-align: center;
    color: var(--light);
    transition: 0.2s;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .close-popup:hover {
    color: var(--red);
    transform: scale(1.2);
    background: rgba(255, 255, 255, 0.1);
  }

  /* Centered close button for login status popup */
  .centered-close {
    position: static;
    display: block;
    margin: 20px auto 0;
    background: var(--red);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.2s;
  }
  
  .centered-close:hover {
    background: var(--dark-red);
    transform: scale(1.05);
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
</head>
<body>
<!-- Top-right account button matching mission.html style -->
<button class="top-btn" id="accountBtn">
  <img src="accimg.png" alt="Account">
</button>

<!-- Popup overlay -->
<div class="popup-overlay" id="popupOverlay">
  <div class="popup">
    <div id="popupContent"></div>
  </div>
</div>

<div class="container">
  <h2 id="formTitle">Login</h2>

  <!-- LOGIN FORM -->
  <form id="loginForm">
    <input id="loginIdentifier" type="text" placeholder="Username or email" required />
    <input id="loginPassword" type="password" placeholder="Password" required />
    <button type="submit" class="btn-white">Login</button>
  </form>

  <!-- SIGNUP FORM -->
  <form id="signupForm" style="display:none; margin-top:10px;">
    <input id="signupUsername" type="text" placeholder="Username" required />
    <input id="signupEmail" type="email" placeholder="Email" required />
    <input id="signupPassword" type="password" placeholder="Password" required />
    <button id="signupBtn" type="submit" class="btn-primary">Create Account</button>
  </form>

  <div class="toggle" id="toggleForm">Don't have an account? Sign up</div>
  <div class="note" id="noteText"></div>
</div>

<script>
const USERS_KEY = "users";
const LOGGED_IN_KEY = "loggedInUser";

// Read users from localStorage
function readUsers() {
  try {
    return JSON.parse(localStorage.getItem(USERS_KEY)) || [];
  } catch(e) {
    return [];
  }
}

// Save users to localStorage
function writeUsers(users) {
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
}

// Update UI depending on existing users
function updateUI() {
  const users = readUsers();
  const hasUsers = users.length > 0;
  const signupForm = document.getElementById("signupForm");
  const toggleForm = document.getElementById("toggleForm");
  const noteText = document.getElementById("noteText");

  if(!hasUsers) {
    // No users yet: show signup, explain first account becomes admin
    signupForm.style.display = "block";
    toggleForm.style.display = "none";
    noteText.innerText = "First account created will be admin.";
    document.getElementById("formTitle").innerText = "Sign up";
  } else {
    // Users exist: show login first
    signupForm.style.display = "none";
    toggleForm.style.display = "block";
    noteText.innerText = "";
    document.getElementById("formTitle").innerText = "Login";
  }
}

// LOGIN HANDLER
document.getElementById("loginForm").addEventListener("submit", function(evt) {
  evt.preventDefault();
  const identifier = document.getElementById("loginIdentifier").value.trim();
  const password = document.getElementById("loginPassword").value;
  const users = readUsers();
  const user = users.find(u => (u.username === identifier || u.email === identifier) && u.password === password);
  if(user) {
    localStorage.setItem(LOGGED_IN_KEY, JSON.stringify(user));
    alert("Welcome back, " + user.username + (user.role === "admin" ? " (admin)" : "") + "!");
    window.location.href = "index.html";
  } else {
    alert("Invalid username/email or password.");
  }
});

// SIGNUP HANDLER
document.getElementById("signupForm").addEventListener("submit", function(evt) {
  evt.preventDefault();
  const username = document.getElementById("signupUsername").value.trim();
  const email = document.getElementById("signupEmail").value.trim();
  const password = document.getElementById("signupPassword").value;

  if(!username || !email || !password) {
    alert("Please enter all fields.");
    return;
  }

  const users = readUsers();
  if(users.find(u => u.username === username || u.email === email)) {
    alert("Username or email already exists.");
    return;
  }

  // First user becomes admin, others are normal users
  const role = users.length === 0 ? "admin" : "user";
  users.push({username, email, password, role});
  writeUsers(users);
  alert("Account created. You can now log in.");
  document.getElementById("signupForm").reset();
  updateUI();
});

// TOGGLE FORM DISPLAY
document.getElementById("toggleForm").addEventListener("click", function() {
  const signupForm = document.getElementById("signupForm");
  const loginForm = document.getElementById("loginForm");
  const formTitle = document.getElementById("formTitle");
  const toggleForm = document.getElementById("toggleForm");

  if(signupForm.style.display === "none" || signupForm.style.display === "") {
    signupForm.style.display = "block";
    loginForm.style.display = "none";
    formTitle.innerText = "Sign up";
    toggleForm.innerText = "Already have an account? Login";
  } else {
    signupForm.style.display = "none";
    loginForm.style.display = "block";
    formTitle.innerText = "Login";
    toggleForm.innerText = "Don't have an account? Sign up";
  }
});

// Account button functionality with centered close button
const overlay = document.getElementById("popupOverlay");
const popup = document.getElementById("popupContent");

function updatePopup() {
  popup.innerHTML = "";
  const user = JSON.parse(localStorage.getItem(LOGGED_IN_KEY));
  if (user) {
    popup.innerHTML = `<div style="margin-bottom: 20px; font-size: 1.2rem;">Logged in as: ${user.username}${user.role === "admin" ? " (admin)" : ""}</div>`;
    const closeBtn = document.createElement("button");
    closeBtn.textContent = "Close";
    closeBtn.className = "centered-close";
    closeBtn.onclick = () => overlay.style.display = "none";
    popup.appendChild(closeBtn);
  } else {
    popup.innerHTML = `<div style="margin-bottom: 20px; font-size: 1.2rem;">You are not currently logged in.</div>`;
    const closeBtn = document.createElement("button");
    closeBtn.textContent = "Close";
    closeBtn.className = "centered-close";
    closeBtn.onclick = () => overlay.style.display = "none";
    popup.appendChild(closeBtn);
  }
}

document.getElementById("accountBtn").onclick = () => {
  updatePopup();
  overlay.style.display = "flex";
};

overlay.onclick = e => {
  if (e.target === overlay) overlay.style.display = "none";
};

// initial UI setup
updateUI();
</script>
</body>
</html>