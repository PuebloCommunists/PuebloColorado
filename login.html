<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login | Organize</title>
<style>
  body { font-family: Arial, Helvetica, sans-serif; background: linear-gradient(135deg,#ff5252,#000); height:100vh; margin:0; display:flex; align-items:center; justify-content:center; color:white; }
  .container { width:360px; padding:2rem; border-radius:12px; background: rgba(255,255,255,0.06); box-shadow:0 6px 24px rgba(0,0,0,0.4); text-align:center; }
  h2 { margin:0 0 1rem 0; color:white; }
  input { width:92%; padding:10px; margin:8px 0; border-radius:8px; border:none; outline:none; }
  button { width:95%; padding:10px; margin-top:10px; border-radius:8px; border:none; cursor:pointer; font-weight:bold; }
  .btn-white { background:white; color:black; }
  .btn-primary { background:#ff5252; color:white; }
  .toggle { margin-top:10px; color:#ddd; cursor:pointer; font-size:0.95rem; }
  .note { margin-top:8px; font-size:0.85rem; color:#eee; opacity:0.9; }
</style>
</head>
<body>
<div class="container">
  <h2 id="formTitle">Login</h2>

  <!-- LOGIN FORM -->
  <form id="loginForm">
    <input id="loginIdentifier" type="text" placeholder="Username or email" required />
    <input id="loginPassword" type="password" placeholder="Password" required />
    <button type="submit" class="btn-white">Login</button>
  </form>

  <!-- SIGNUP FORM -->
  <form id="signupForm" style="display:none; margin-top:10px;">
    <input id="signupUsername" type="text" placeholder="Username" required />
    <input id="signupEmail" type="email" placeholder="Email" required />
    <input id="signupPassword" type="password" placeholder="Password" required />
    <button id="signupBtn" type="submit" class="btn-primary">Create Account</button>
  </form>

  <div class="toggle" id="toggleForm">Don't have an account? Sign up</div>
  <div class="note" id="noteText"></div>
</div>

<script>
const USERS_KEY = "users";
const LOGGED_IN_KEY = "loggedInUser";

// Read users from localStorage
function readUsers() {
  try {
    return JSON.parse(localStorage.getItem(USERS_KEY)) || [];
  } catch(e) {
    return [];
  }
}

// Save users to localStorage
function writeUsers(users) {
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
}

// Update UI depending on existing users
function updateUI() {
  const users = readUsers();
  const hasUsers = users.length > 0;
  const signupForm = document.getElementById("signupForm");
  const toggleForm = document.getElementById("toggleForm");
  const noteText = document.getElementById("noteText");

  if(!hasUsers) {
    // No users yet: show signup, explain first account becomes admin
    signupForm.style.display = "block";
    toggleForm.style.display = "none";
    noteText.innerText = "First account created will be admin.";
    document.getElementById("formTitle").innerText = "Sign up";
  } else {
    // Users exist: show login first
    signupForm.style.display = "none";
    toggleForm.style.display = "block";
    noteText.innerText = "";
    document.getElementById("formTitle").innerText = "Login";
  }
}

// LOGIN HANDLER
document.getElementById("loginForm").addEventListener("submit", function(evt) {
  evt.preventDefault();
  const identifier = document.getElementById("loginIdentifier").value.trim();
  const password = document.getElementById("loginPassword").value;
  const users = readUsers();
  const user = users.find(u => (u.username === identifier || u.email === identifier) && u.password === password);
  if(user) {
    localStorage.setItem(LOGGED_IN_KEY, JSON.stringify(user));
    alert("Welcome back, " + user.username + (user.role === "admin" ? " (admin)" : "") + "!");
    window.location.href = "index.html";
  } else {
    alert("Invalid username/email or password.");
  }
});

// SIGNUP HANDLER
document.getElementById("signupForm").addEventListener("submit", function(evt) {
  evt.preventDefault();
  const username = document.getElementById("signupUsername").value.trim();
  const email = document.getElementById("signupEmail").value.trim();
  const password = document.getElementById("signupPassword").value;

  if(!username || !email || !password) {
    alert("Please enter all fields.");
    return;
  }

  const users = readUsers();
  if(users.find(u => u.username === username || u.email === email)) {
    alert("Username or email already exists.");
    return;
  }

  // First user becomes admin, others are normal users
  const role = users.length === 0 ? "admin" : "user";
  users.push({username, email, password, role});
  writeUsers(users);
  alert("Account created. You can now log in.");
  document.getElementById("signupForm").reset();
  updateUI();
});

// TOGGLE FORM DISPLAY
document.getElementById("toggleForm").addEventListener("click", function() {
  const signupForm = document.getElementById("signupForm");
  const loginForm = document.getElementById("loginForm");
  const formTitle = document.getElementById("formTitle");
  const toggleForm = document.getElementById("toggleForm");

  if(signupForm.style.display === "none" || signupForm.style.display === "") {
    signupForm.style.display = "block";
    loginForm.style.display = "none";
    formTitle.innerText = "Sign up";
    toggleForm.innerText = "Already have an account? Login";
  } else {
    signupForm.style.display = "none";
    loginForm.style.display = "block";
    formTitle.innerText = "Login";
    toggleForm.innerText = "Don't have an account? Sign up";
  }
});

// initial UI setup
updateUI();
</script>
</body>
</html>
